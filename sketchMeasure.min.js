setTimeout(()=>{const d=document.getElementsByClassName("screen-viewer-inner")?.[0],o=document.getElementById("screen"),n=document.getElementById("rulers"),a=document.getElementById("flow-mode");if(d&&o&&n&&a){const c=(d,t)=>{Object.keys(t).forEach(e=>{d.style[e]=t[e]})},t=document.createElement("style"),l=(t.innerHTML=".layer{z-index: 1;}",document.head.appendChild(t),document.createElement("iframe")),s=(c(l,{border:"none",position:"absolute"}),l.width="100%",l.height="100%",l.src=localStorage.getItem("SKETCH_MEASURE_EXTENSION_IFRAME_SRC")||"https://m.baidu.com/",l.onload=()=>{if(l.contentDocument){const e=document.createElement("script");e.src="https://neco86.github.io/Sketch-Measure-Compare/rulers.min.js",l.contentDocument.head.appendChild(e)}},document.createElement("input")),p=(c(s,{border:"none",outline:"none",height:"20px"}),s.placeholder="url",s.value=l.src,s.oninput=e=>{l.src=e.target.value,localStorage.setItem("SKETCH_MEASURE_EXTENSION_IFRAME_SRC",l.src)},s.onkeyup=e=>{"Enter"===e.key&&(l.src="",l.src=e.target.value)},o.cloneNode(!1)),r=(c(p,{backgroundImage:"",overflow:"hidden"}),n.cloneNode(!0)),N=(r.appendChild(r.childNodes[0].cloneNode(!0)),r.appendChild(r.childNodes[1].cloneNode(!0)),c(r.childNodes[0],{border:"none",borderLeft:"1px dashed #419bf9",width:"0px"}),c(r.childNodes[1],{border:"none",borderTop:"1px dashed #419bf9",height:"0px"}),c(r.childNodes[2],{border:"none",borderRight:"1px dashed #419bf9",width:"0px"}),c(r.childNodes[3],{border:"none",borderBottom:"1px dashed #419bf9",height:"0px"}),n.cloneNode(!0)),y=(N.appendChild(N.childNodes[0].cloneNode(!0)),N.appendChild(N.childNodes[1].cloneNode(!0)),c(N.childNodes[0],{border:"none",borderLeft:"1px dashed #ee6723",width:"0px"}),c(N.childNodes[1],{border:"none",borderTop:"1px dashed #ee6723",height:"0px"}),c(N.childNodes[2],{border:"none",borderRight:"1px dashed #ee6723",width:"0px"}),c(N.childNodes[3],{border:"none",borderBottom:"1px dashed #ee6723",height:"0px"}),document.getElementById("ld").cloneNode(!0)),x=document.getElementById("td").cloneNode(!0),m=document.getElementById("rd").cloneNode(!0),g=document.getElementById("bd").cloneNode(!0);p.appendChild(l),p.appendChild(r),p.appendChild(N),p.appendChild(y),p.appendChild(x),p.appendChild(m),p.appendChild(g),d.appendChild(s),d.appendChild(p);var e=()=>{var{width:e,height:d,marginTop:t}=o.style,t=(e!==p.style.width&&(l.src="",l.src=s.value),c(p,{width:e,height:d,marginTop:t,marginLeft:a.checked?0:parseFloat(e)/2+10+"px",opacity:a.checked?.5:1}),p.className=o.className,c(s,{width:e,marginTop:`-${parseFloat(d)/2+20+10}px`,marginLeft:a.checked?0:parseFloat(e)/2+10+"px"}),s.className=o.className,c(r,n.style),c(r.childNodes[0],{left:n.childNodes[0].style.left}),c(r.childNodes[1],{top:n.childNodes[1].style.top}),c(r.childNodes[2],{left:parseFloat(n.childNodes[0].style.left)+parseFloat(n.childNodes[0].style.width)+"px"}),c(r.childNodes[3],{top:parseFloat(n.childNodes[1].style.top)+parseFloat(n.childNodes[1].style.height)+"px"}),document.getElementsByClassName("selected")?.[0]?.style);t&&(c(N,{display:""}),c(N.childNodes[0],{left:t.left}),c(N.childNodes[1],{top:t.top}),c(N.childNodes[2],{left:parseFloat(t.left)+parseFloat(t.width)+"px"}),c(N.childNodes[3],{top:parseFloat(t.top)+parseFloat(t.height)+"px"})),a.checked&&(c(n,{display:"none"}),c(r,{display:"none"}),c(N,{display:"none"}),c(y,{display:"none"}),c(x,{display:"none"}),c(m,{display:"none"}),c(g,{display:"none"}))};e(),window.addEventListener("message",({data:e})=>{var d,t,o,l,s,p,i,h;e&&e.msg&&({msg:e,payload:i}=e,"updateRulers"===e&&(c(n,{display:a.checked?"none":""}),c(n.childNodes[0],{left:i.left+"px",width:i.width+"px"}),c(n.childNodes[1],{top:i.top+"px",height:i.height+"px"}),c(r,{display:a.checked?"none":""}),c(r.childNodes[0],{left:i.left+"px"}),c(r.childNodes[1],{top:i.top+"px"}),c(r.childNodes[2],{left:i.left+i.width+"px"}),c(r.childNodes[3],{top:i.top+i.height+"px"}),"none"!==N.style.display&&(e=parseFloat(N.childNodes[0].style.left),d=parseFloat(N.childNodes[1].style.top),t=parseFloat(N.childNodes[2].style.left),o=parseFloat(N.childNodes[3].style.top),l=i.left,s=i.top,p=i.left+i.width,i=i.top+i.height,h=l||s||p||i,p<=e?c(y,{display:h?"":"none",left:p+"px",top:d+(o-d)/2+"px",width:e-p+"px"}):c(y,{display:l<t&&h?"":"none",left:`${l<e?l:e}px`,top:d+(o-d)/2+"px",width:Math.abs(l-e)+"px"}),y.childNodes[0].dataset.width=y.style.width,t<=l?c(m,{display:h?"":"none",left:t+"px",top:d+(o-d)/2+"px",width:l-t+"px"}):c(m,{display:e<p&&h?"":"none",left:`${t<p?t:p}px`,top:d+(o-d)/2+"px",width:Math.abs(p-t)+"px"}),m.childNodes[0].dataset.width=m.style.width,i<=d?c(x,{display:h?"":"none",left:e+(t-e)/2+"px",top:i+"px",height:d-i+"px"}):c(x,{display:s<o&&h?"":"none",left:e+(t-e)/2+"px",top:`${s<d?s:d}px`,height:Math.abs(s-d)+"px"}),x.childNodes[0].dataset.height=x.style.height,o<=s?c(g,{display:h?"":"none",left:e+(t-e)/2+"px",top:o+"px",height:s-o+"px"}):c(g,{display:d<i&&h?"":"none",left:e+(t-e)/2+"px",top:`${o<i?o:i}px`,height:Math.abs(i-o)+"px"}),g.childNodes[0].dataset.height=g.style.height)))}),document.onkeyup=e=>{"c"!==e.key||a.checked||(c(N,{display:""}),c(N.childNodes[0],{left:r.childNodes[0].style.left}),c(N.childNodes[1],{top:r.childNodes[1].style.top}),c(N.childNodes[2],{left:r.childNodes[2].style.left}),c(N.childNodes[3],{top:r.childNodes[3].style.top}),d.click())};const i=new MutationObserver(e);i.observe(o,{attributes:!0,childList:!0,subtree:!0})}},220);